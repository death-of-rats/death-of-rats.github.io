<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Death Of Rats (Posts about ctf)</title><link>https://death-of-rats.github.io/</link><description></description><atom:link href="https://death-of-rats.github.io/categories/cat_ctf.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents Â© 2018 death-of-rats 
&lt;a rel="license" href="http://creativecommons.org/licenses/by/4.0/"&gt;&lt;img alt="Creative Commons Licence" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/80x15.png" /&gt;&lt;/a&gt;&lt;br /&gt;This work is licensed under a &lt;a rel="license" href="http://creativecommons.org/licenses/by/4.0/"&gt;Creative Commons Attribution 4.0 International License&lt;/a&gt;.</copyright><lastBuildDate>Tue, 18 Dec 2018 01:10:07 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Icon 2018 CTF third challenge</title><link>https://death-of-rats.github.io/posts/icon_2018_ctf_third_challenge/</link><dc:creator>death-of-rats</dc:creator><description>&lt;div&gt;&lt;p&gt;The third challenge is a reverse engineering problem. The zipped package contains 3 files:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;&lt;span&gt;&lt;/span&gt;crackme_baby
crackme.py
run.sh
&lt;/pre&gt;


&lt;p&gt;Python file contains definitions of simple math operations (add, sub, mul, div2, mod, inf). Let us
 disassemble crackme_baby file.&lt;/p&gt;
&lt;p&gt;Main function shows us that 2 long variables are in play, &lt;code&gt;d1 = 25052671110843108&lt;/code&gt; 
 and &lt;code&gt;d2 = 16420105858350620421142892712&lt;/code&gt;. They are passed to &lt;code&gt;calc_flag__object___object&lt;/code&gt; to calculate 
value for the flag. This value is hashed with sha256 and print in format flag{&lt;em&gt;hashed_value&lt;/em&gt;}.&lt;/p&gt;
&lt;pre class="code literal-block"&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nf"&gt;.0x000021c3&lt;/span&gt;      &lt;span class="nv"&gt;push&lt;/span&gt; &lt;span class="nb"&gt;rbp&lt;/span&gt;                    &lt;span class="c1"&gt;; main(int argc, char** argv)&lt;/span&gt;
&lt;span class="nf"&gt;.0x000021c4&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rbp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rsp&lt;/span&gt;
&lt;span class="nf"&gt;.0x000021c7&lt;/span&gt;      &lt;span class="nv"&gt;push&lt;/span&gt; &lt;span class="nb"&gt;rbx&lt;/span&gt;
&lt;span class="nf"&gt;.0x000021c8&lt;/span&gt;      &lt;span class="nv"&gt;sub&lt;/span&gt; &lt;span class="nb"&gt;rsp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mh"&gt;0x88&lt;/span&gt;
&lt;span class="nf"&gt;.0x000021cf&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="kt"&gt;dword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_84h&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;edi&lt;/span&gt;  &lt;span class="c1"&gt;; argc&lt;/span&gt;
&lt;span class="nf"&gt;.0x000021d5&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_90h&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;rsi&lt;/span&gt;  &lt;span class="c1"&gt;; argv&lt;/span&gt;
&lt;span class="nf"&gt;.0x000021dc&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="nb"&gt;fs&lt;/span&gt;&lt;span class="p"&gt;:[&lt;/span&gt;&lt;span class="mh"&gt;0x28&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;    &lt;span class="c1"&gt;; [0x28:8]=0x6108 ; '('&lt;/span&gt;
&lt;span class="nf"&gt;.0x000021e5&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_18h&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x000021e9&lt;/span&gt;      &lt;span class="nv"&gt;xor&lt;/span&gt; &lt;span class="nb"&gt;eax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;eax&lt;/span&gt;
&lt;span class="nf"&gt;.0x000021eb&lt;/span&gt;      &lt;span class="nv"&gt;call&lt;/span&gt; &lt;span class="nv"&gt;sym.imp.Py_Initialize&lt;/span&gt;
&lt;span class="nf"&gt;.0x000021f0&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;edx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mh"&gt;0xa&lt;/span&gt;
&lt;span class="nf"&gt;.0x000021f5&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;esi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="nf"&gt;.0x000021fa&lt;/span&gt;      &lt;span class="nv"&gt;lea&lt;/span&gt; &lt;span class="nb"&gt;rdi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="nv"&gt;str.25052671110843108&lt;/span&gt; &lt;span class="c1"&gt;; 0x2aa0 ; "25052671110843108"&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002201&lt;/span&gt;      &lt;span class="nv"&gt;call&lt;/span&gt; &lt;span class="nv"&gt;sym.imp.PyLong_FromString&lt;/span&gt;       &lt;span class="c1"&gt;; create python long object&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002206&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_78h&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;           &lt;span class="c1"&gt;; here we have d1&lt;/span&gt;
&lt;span class="nf"&gt;.0x0000220a&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;edx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mh"&gt;0xa&lt;/span&gt;
&lt;span class="nf"&gt;.0x0000220f&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;esi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002214&lt;/span&gt;      &lt;span class="nv"&gt;lea&lt;/span&gt; &lt;span class="nb"&gt;rdi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="nv"&gt;str.16420105858350620421142892712&lt;/span&gt; &lt;span class="c1"&gt;; 0x2ab2 ; "16420105858350620421142892712"&lt;/span&gt;
&lt;span class="nf"&gt;.0x0000221b&lt;/span&gt;      &lt;span class="nv"&gt;call&lt;/span&gt; &lt;span class="nv"&gt;sym.imp.PyLong_FromString&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002220&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_70h&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;           &lt;span class="c1"&gt;; here we have d2&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002224&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rdx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_70h&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002228&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_78h&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nf"&gt;.0x0000222c&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rsi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rdx&lt;/span&gt;
&lt;span class="nf"&gt;.0x0000222f&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rdi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002232&lt;/span&gt;      &lt;span class="nv"&gt;call&lt;/span&gt; &lt;span class="nv"&gt;sym.calc_flag__object___object&lt;/span&gt; &lt;span class="c1"&gt;; compute the value for the flag&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002237&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_68h&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x0000223b&lt;/span&gt;      &lt;span class="nv"&gt;lea&lt;/span&gt; &lt;span class="nb"&gt;rsi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="nv"&gt;str.flag&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;&lt;span class="nv"&gt;_flag&lt;/span&gt; &lt;span class="c1"&gt;; 0x2ad0 ; "flag: flag{"  &lt;/span&gt;
&lt;span class="nf"&gt;.0x00002242&lt;/span&gt;      &lt;span class="nv"&gt;lea&lt;/span&gt; &lt;span class="nb"&gt;rdi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="nv"&gt;obj._ZSt4cout__GLIBCXX_3.4&lt;/span&gt; &lt;span class="c1"&gt;; 0x204020&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002249&lt;/span&gt;      &lt;span class="nv"&gt;call&lt;/span&gt; &lt;span class="nv"&gt;sym.std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nv"&gt;basic_ostream_char_std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nb"&gt;ch&lt;/span&gt;&lt;span class="nv"&gt;ar_traits_char___std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nv"&gt;operator___std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nb"&gt;ch&lt;/span&gt;&lt;span class="nv"&gt;ar_traits_char___std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nv"&gt;basic_ostream_char_std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nb"&gt;ch&lt;/span&gt;&lt;span class="nv"&gt;ar_traits_char____charconst&lt;/span&gt;
&lt;span class="nf"&gt;.0x0000224e&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rbx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002251&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_68h&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="c1"&gt;; get computed value&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002255&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rdi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002258&lt;/span&gt;      &lt;span class="nv"&gt;call&lt;/span&gt; &lt;span class="nv"&gt;sym.imp.PyLong_AsLong&lt;/span&gt; &lt;span class="c1"&gt;; convert Python object to long&lt;/span&gt;
&lt;span class="nf"&gt;.0x0000225d&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rdx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002260&lt;/span&gt;      &lt;span class="nv"&gt;lea&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_60h&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002264&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rsi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rdx&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002267&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rdi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x0000226a&lt;/span&gt;      &lt;span class="nv"&gt;call&lt;/span&gt; &lt;span class="nv"&gt;sym.std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nv"&gt;__cxx11&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nv"&gt;to_string_long&lt;/span&gt; &lt;span class="c1"&gt;; long -&amp;gt; string&lt;/span&gt;
&lt;span class="nf"&gt;.0x0000226f&lt;/span&gt;      &lt;span class="nv"&gt;lea&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_40h&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="c1"&gt;; buffer for sha256 result&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002273&lt;/span&gt;      &lt;span class="nv"&gt;lea&lt;/span&gt; &lt;span class="nb"&gt;rdx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_60h&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="c1"&gt;; string with the computed long value&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002277&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rsi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rdx&lt;/span&gt;
&lt;span class="nf"&gt;.0x0000227a&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rdi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x0000227d&lt;/span&gt;      &lt;span class="nv"&gt;call&lt;/span&gt; &lt;span class="nv"&gt;sym.sha256_std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nv"&gt;__cxx11&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nv"&gt;basic_string_char_std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nb"&gt;ch&lt;/span&gt;&lt;span class="nv"&gt;ar_traits_char__std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nb"&gt;al&lt;/span&gt;&lt;span class="nv"&gt;locator_char&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002282&lt;/span&gt;      &lt;span class="nv"&gt;lea&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_40h&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="c1"&gt;; we will print sha256 hash&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002286&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rsi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002289&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rdi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rbx&lt;/span&gt;
&lt;span class="nf"&gt;.0x0000228c&lt;/span&gt;      &lt;span class="nv"&gt;call&lt;/span&gt; &lt;span class="nv"&gt;sym.std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nv"&gt;basic_ostream_char_std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nb"&gt;ch&lt;/span&gt;&lt;span class="nv"&gt;ar_traits_char___std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nv"&gt;operator___char_std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nb"&gt;ch&lt;/span&gt;&lt;span class="nv"&gt;ar_traits_char__std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nb"&gt;al&lt;/span&gt;&lt;span class="nv"&gt;locator_char___std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nv"&gt;basic_ostream_char_std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nb"&gt;ch&lt;/span&gt;&lt;span class="nv"&gt;ar_traits_char____std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nv"&gt;__cxx11&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nv"&gt;basic_string_char_std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nb"&gt;ch&lt;/span&gt;&lt;span class="nv"&gt;ar_traits_char__std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nb"&gt;al&lt;/span&gt;&lt;span class="nv"&gt;locator_char__const&lt;/span&gt;
&lt;span class="nf"&gt;.0x00002291&lt;/span&gt;      &lt;span class="nv"&gt;lea&lt;/span&gt; &lt;span class="nb"&gt;rsi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x00002adc&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="c1"&gt;; "}" &lt;/span&gt;
&lt;span class="nf"&gt;.0x00002298&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rdi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x0000229b&lt;/span&gt;      &lt;span class="nv"&gt;call&lt;/span&gt; &lt;span class="nv"&gt;sym.std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nv"&gt;basic_ostream_char_std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nb"&gt;ch&lt;/span&gt;&lt;span class="nv"&gt;ar_traits_char___std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nv"&gt;operator___std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nb"&gt;ch&lt;/span&gt;&lt;span class="nv"&gt;ar_traits_char___std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nv"&gt;basic_ostream_char_std&lt;/span&gt;&lt;span class="p"&gt;::&lt;/span&gt;&lt;span class="nb"&gt;ch&lt;/span&gt;&lt;span class="nv"&gt;ar_traits_char____charconst&lt;/span&gt;
&lt;span class="nf"&gt;.0x000022a0&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rdx&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
                  &lt;span class="nf"&gt;...&lt;/span&gt;
&lt;/pre&gt;


&lt;p&gt;So it's time to look closer at function &lt;code&gt;calc_flag__object___object&lt;/code&gt;. First instructions just load &lt;code&gt;crackme.py&lt;/code&gt; 
and import math functions: &lt;/p&gt;
&lt;pre class="code literal-block"&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="nf"&gt;.0x00001e83&lt;/span&gt;      &lt;span class="nv"&gt;push&lt;/span&gt; &lt;span class="nb"&gt;rbp&lt;/span&gt;                               
&lt;span class="nf"&gt;.0x00001e84&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rbp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rsp&lt;/span&gt;                
&lt;span class="nf"&gt;.0x00001e87&lt;/span&gt;      &lt;span class="nv"&gt;sub&lt;/span&gt; &lt;span class="nb"&gt;rsp&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="mh"&gt;0x70&lt;/span&gt;               &lt;span class="c1"&gt;; 'p'&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001e8b&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_68h&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;rdi&lt;/span&gt;  &lt;span class="c1"&gt;; d1&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001e8f&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_70h&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;rsi&lt;/span&gt;  &lt;span class="c1"&gt;; d2&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001e93&lt;/span&gt;      &lt;span class="nv"&gt;lea&lt;/span&gt; &lt;span class="nb"&gt;rdi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="nv"&gt;str.crackme&lt;/span&gt;  &lt;span class="c1"&gt;; 0x2a7f ; "crackme"&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001e9a&lt;/span&gt;      &lt;span class="nv"&gt;call&lt;/span&gt; &lt;span class="nv"&gt;sym.imp.PyUnicode_FromString&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001e9f&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_48h&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001ea3&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_48h&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001ea7&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rdi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;                           
&lt;span class="nf"&gt;.0x00001eaa&lt;/span&gt;      &lt;span class="nv"&gt;call&lt;/span&gt; &lt;span class="nv"&gt;sym.imp.PyImport_Import&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001eaf&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_40h&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;             
&lt;span class="nf"&gt;.0x00001eb3&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_40h&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001eb7&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rdi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001eba&lt;/span&gt;      &lt;span class="nv"&gt;call&lt;/span&gt; &lt;span class="nv"&gt;sym.imp.PyModule_GetDict&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001ebf&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_38h&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001ec3&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_38h&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001ec7&lt;/span&gt;      &lt;span class="nv"&gt;lea&lt;/span&gt; &lt;span class="nb"&gt;rsi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x00002a87&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="c1"&gt;; "add"&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001ece&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rdi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001ed1&lt;/span&gt;      &lt;span class="nv"&gt;call&lt;/span&gt; &lt;span class="nv"&gt;sym.imp.PyDict_GetItemString&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001ed6&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_30h&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001eda&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_38h&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001ede&lt;/span&gt;      &lt;span class="nv"&gt;lea&lt;/span&gt; &lt;span class="nb"&gt;rsi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x00002a8b&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="c1"&gt;; "sub"&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001ee5&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rdi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001ee8&lt;/span&gt;      &lt;span class="nv"&gt;call&lt;/span&gt; &lt;span class="nv"&gt;sym.imp.PyDict_GetItemString&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001eed&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_28h&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001ef1&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_38h&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001ef5&lt;/span&gt;      &lt;span class="nv"&gt;lea&lt;/span&gt; &lt;span class="nb"&gt;rsi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x00002a8f&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="c1"&gt;; "mul"&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001efc&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rdi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001eff&lt;/span&gt;      &lt;span class="nv"&gt;call&lt;/span&gt; &lt;span class="nv"&gt;sym.imp.PyDict_GetItemString&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001f04&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_20h&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001f08&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_38h&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001f0c&lt;/span&gt;      &lt;span class="nv"&gt;lea&lt;/span&gt; &lt;span class="nb"&gt;rsi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="nv"&gt;str.div2&lt;/span&gt;     &lt;span class="c1"&gt;; 0x2a93 ; "div2"&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001f13&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rdi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001f16&lt;/span&gt;      &lt;span class="nv"&gt;call&lt;/span&gt; &lt;span class="nv"&gt;sym.imp.PyDict_GetItemString&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001f1b&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_18h&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001f1f&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_38h&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001f23&lt;/span&gt;      &lt;span class="nv"&gt;lea&lt;/span&gt; &lt;span class="nb"&gt;rsi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x00002a98&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="c1"&gt;; "mod"&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001f2a&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rdi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001f2d&lt;/span&gt;      &lt;span class="nv"&gt;call&lt;/span&gt; &lt;span class="nv"&gt;sym.imp.PyDict_GetItemString&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001f32&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_10h&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001f36&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_38h&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001f3a&lt;/span&gt;      &lt;span class="nv"&gt;lea&lt;/span&gt; &lt;span class="nb"&gt;rsi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="mh"&gt;0x00002a9c&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt; &lt;span class="c1"&gt;; "sup"&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001f41&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="nb"&gt;rdi&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001f44&lt;/span&gt;      &lt;span class="nv"&gt;call&lt;/span&gt; &lt;span class="nv"&gt;sym.imp.PyDict_GetItemString&lt;/span&gt;
&lt;span class="nf"&gt;.0x00001f49&lt;/span&gt;      &lt;span class="nv"&gt;mov&lt;/span&gt; &lt;span class="kt"&gt;qword&lt;/span&gt; &lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="nv"&gt;local_8h&lt;/span&gt;&lt;span class="p"&gt;],&lt;/span&gt; &lt;span class="nb"&gt;rax&lt;/span&gt;
&lt;/pre&gt;


&lt;p&gt;From above code we can extract variables with functions imported and assigned to them:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;&lt;span&gt;&lt;/span&gt; local_30h | add
 local_28h | sub
 local_20h | mul
 local_18h | div2
 local_10h | mod
 local_8h  | sup
&lt;/pre&gt;


&lt;p&gt;and also our longs:&lt;/p&gt;
&lt;pre class="code literal-block"&gt;&lt;span&gt;&lt;/span&gt; local_68h | d1
 local_70h | d2
&lt;/pre&gt;


&lt;p&gt;We will need this to find out what calculations take place in &lt;code&gt;calc_flag__object___object&lt;/code&gt;. 
I will replace &lt;em&gt;local_xxh&lt;/em&gt; with known or chosen names.
This way the graph below should be easier to understand.&lt;/p&gt;
&lt;pre class="code literal-block"&gt;&lt;span&gt;&lt;/span&gt;                                                        ...
                                   | mov qword [sup], rax                       |                               
                                   | mov edi, 2                                 |                               
                                   | call sym.imp.PyLong_FromLong;[ge]          |                               
                                   | mov qword [factor], rax                    |                               
                                   | mov edi, 1                                 |                               
                                   | call sym.imp.PyLong_FromLong;[ge]          |                               
                                   | mov qword [last_factor], rax               |                               
                                   `--------------------------------------------'                               
                                                               |                                                
                                                               |                                                
     .---------------------------------------------------------.                                                
     |                                                         |                                                
     |                                                         |                                                
     |                        .------------------------------------------------------------------.              
     |                        |  0x1f69 ;[gj]                                                    |              
     |                        |      ; JMP XREF from 0x0000200d (sym.calc_flag__object___object) |              
     |                        | mov edi, 1                                                       |              
     |                        | call sym.imp.PyLong_FromLong;[ge]                                |              
     |                        | mov rdx, rax                                                     |              
     |                        | mov rcx, qword [d1]                                              |              
     |                        | mov rax, qword [sup]                                             |              
     |                        | mov rsi, rcx                                                     |              
     |                        | mov rdi, rax                                                     |              
     |                        | call sym.call__object___object___object;[gg]                     | 
     |                        | mov rdi, rax                                                     |              
     |                        | call sym.imp.PyLong_AsLong;[gh]                                  |              
     |                        | test rax, rax                                                    |              
     |                        | setne al                                                         |              
     |                        | test al, al                                                      |              
     |                        | je 0x2012;[gi]                                                   |              
     |                        `------------------------------------------------------------------'              
     |                                                             | |                                          
     |                                                             | '------------.                             
     |                    .----------------------------------------'              |                             
     |.---------------.   |                                                       |                             
     ||               |   |                                                       |                             
     ||               |   |                                                       |                             
     ||  .-----------------------------------------------.  .-----------------------------------------------.  
     ||  |  0x1f9b ;[gl]                                 |  | [0x2012] ;[gi]                                |  
     ||  |      ; JMP XREF from 0x00001fe7               |  |      ; JMP XREF from 0x00001f99               | 
     ||  |      ;   (sym.calc_flag__object___object)     |  |      ;   (sym.calc_flag__object___object)     |
     ||  | mov rdx, qword [factor]                       |  | mov rdx, qword [last_factor]                  |  
     ||  | mov rcx, qword [d1]                           |  | mov rcx, qword [d2]                           |  
     ||  | mov rax, qword [mod]                          |  | mov rax, qword [sub]                          |  
     ||  | mov rsi, rcx                                  |  | mov rsi, rcx                                  |  
     ||  | mov rdi, rax                                  |  | mov rdi, rax                                  |  
     ||  | call sym.call__object___object___object;[gg]  |  | call sym.call__object___object___object;[gg]  |  
     ||  | mov rdi, rax                                  |  | leave                                         |  
     ||  | call sym.imp.PyLong_AsLong;[gh]               |  | ret                                           |  
     ||  | test rax, rax                                 |  `-----------------------------------------------'  
     ||  | sete al                                       |                                                                      
     ||  | test al, al                                   |                                                                      
     ||  | je 0x1fe9;[gk]                                |                                                                      
     ||  `-----------------------------------------------'                                                                      
     ||                   | |                                                                                                    
     ||                   | '------------------------------------.                                                               
     ||        .----------'                                      |                                                               
     ||        |                                                 |                                                               
     ||        |                                                 |                                                               
     ||.-----------------------------------------------.   .------------------------------------------------------------------.  
     |||  0x1fc4 ;[gm]                                 |   |  0x1fe9 ;[gk]                                                    |  
     ||| mov rdx, qword [factor]                       |   |      ; JMP XREF from 0x00001fc2 (sym.calc_flag__object___object) |  
     ||| mov rcx, qword [d1]                           |   | mov edi, 1                                                       |  
     ||| mov rax, qword [div2]                         |   | call sym.imp.PyLong_FromLong;[ge]                                |  
     ||| mov rsi, rcx                                  |   | mov rdx, rax                                                     |  
     ||| mov rdi, rax                                  |   | mov rcx, qword [factor]                                          |  
     ||| call sym.call__object___object___object;[gg]  |   | mov rax, qword [add]                                             |  
     ||| mov qword [d1], rax                           |   | mov rsi, rcx                                                     |  
     ||| mov rax, qword [factor]                       |   | mov rdi, rax                                                     |  
     ||| mov qword [last_factor], rax                  |   | call sym.call__object___object___object;[gg]                     |  
     ||| jmp 0x1f9b;[gl]                               |   | mov qword [factor], rax                                          |  
     ||`-----------------------------------------------'   | jmp 0x1f69;[gj]                                                  |  
     ||    |                                               `------------------------------------------------------------------'  
     ||    |                                                   |                                                                 
     |`----'                                                   |                                                    
     `---------------------------------------------------------' 
&lt;/pre&gt;


&lt;p&gt;Calling python functions convention is to put the address of an imported function to &lt;code&gt;rdi&lt;/code&gt; register and
the address of python object with the first argument to &lt;code&gt;rsi&lt;/code&gt;, &lt;code&gt;rdx&lt;/code&gt; will have the second argument address. Then there is a call to
 &lt;code&gt;sym.call__object___object___object&lt;/code&gt;, the result will be also python object which address will be in &lt;code&gt;rax&lt;/code&gt; register.&lt;/p&gt;
&lt;p&gt;The algorithm shown above could be described like this:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Set &lt;code&gt;factor = 2&lt;/code&gt; and &lt;code&gt;last_factor = 1&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Next, we check if &lt;code&gt;d1&lt;/code&gt; is greater than &lt;code&gt;1&lt;/code&gt;. If not &lt;code&gt;return d2 - last_factor&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Test if &lt;code&gt;factor&lt;/code&gt; divides &lt;code&gt;d1&lt;/code&gt; with no rest. If &lt;em&gt;True&lt;/em&gt; then go to &lt;em&gt;step 4&lt;/em&gt;  else &lt;em&gt;step 5&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;d1 = d1 / factor&lt;/code&gt; and save the value of &lt;code&gt;factor&lt;/code&gt; in &lt;code&gt;last_factor&lt;/code&gt; and go to &lt;em&gt;step 3&lt;/em&gt;. &lt;/li&gt;
&lt;li&gt;&lt;code&gt;factor += 1&lt;/code&gt; and go to &lt;em&gt;step 2&lt;/em&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;In other words, when condition &lt;code&gt;d1 &amp;gt; 1&lt;/code&gt; will not be fulfilled &lt;code&gt;last_factor&lt;/code&gt; will hold the greatest
 prime factor of &lt;code&gt;d1&lt;/code&gt;. And this value will be subtracted from &lt;code&gt;d2&lt;/code&gt; and the result will be returned
 from the function. As you might already suspect running this program will give us nothing.
 So we better write our faster version of it.&lt;/p&gt;
&lt;p&gt;To get the greatest prime factor of &lt;code&gt;d1&lt;/code&gt; I will use &lt;strong&gt;&lt;a href="https://pypi.org/project/primefac/"&gt;primefac&lt;/a&gt;&lt;/strong&gt;  python library.&lt;/p&gt;
&lt;pre class="code literal-block"&gt;&lt;span&gt;&lt;/span&gt;&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;primefac&lt;/span&gt;
&lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="nn"&gt;hashlib&lt;/span&gt;

&lt;span class="n"&gt;arg1&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;25052671110843108&lt;/span&gt;
&lt;span class="n"&gt;arg2&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;16420105858350620421142892712&lt;/span&gt;

&lt;span class="n"&gt;fac&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;list&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt; &lt;span class="n"&gt;primefac&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;primefac&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;arg1&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;bigestPrime&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;fac&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="o"&gt;-&lt;/span&gt;&lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;]&lt;/span&gt;
&lt;span class="n"&gt;flag&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;arg2&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;bigestPrime&lt;/span&gt;
&lt;span class="n"&gt;flag_str&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="nb"&gt;str&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flag&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hashlib&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;sha256&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;flag_str&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;encode&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s1"&gt;'utf-8'&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;hexdigest&lt;/span&gt;&lt;span class="p"&gt;()&lt;/span&gt;
&lt;span class="k"&gt;print&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/pre&gt;


&lt;p&gt;And here we have the content of the flag.&lt;/p&gt;
&lt;p&gt;...&lt;strong&gt;SQUEAK&lt;/strong&gt;!&lt;/p&gt;&lt;/div&gt;</description><category>ctf</category><category>icon</category><category>re</category><category>reverse</category><category>writeups</category><guid>https://death-of-rats.github.io/posts/icon_2018_ctf_third_challenge/</guid><pubDate>Thu, 13 Sep 2018 22:00:00 GMT</pubDate></item></channel></rss>